(()=>{var e={715:()=>{},876:()=>{}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}(()=>{"use strict";const e=function(e){var t,i,a=void 0!==(e=e||{})?e:{};a.ready=new Promise((function(e,n){t=e,i=n}));var r,s,o,c,h,l=Object.assign({},a),u=[],p="object"==typeof window,d="function"==typeof importScripts,f="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,v="";f?(v=d?n(876).dirname(v)+"/":"//",c=n(715),h=n(876),r=(e,t)=>(e=h.normalize(e),c.readFileSync(e,t?void 0:"utf8")),o=e=>{var t=r(e,!0);return t.buffer||(t=new Uint8Array(t)),t},s=(e,t,n)=>{e=h.normalize(e),c.readFile(e,(function(e,i){e?n(e):t(i.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),u=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof L))throw e})),process.on("unhandledRejection",(function(e){throw e})),a.inspect=function(){return"[Emscripten Module object]"}):(p||d)&&(d?v=self.location.href:"undefined"!=typeof document&&document.currentScript&&(v=document.currentScript.src),v=0!==v.indexOf("blob:")?v.substr(0,v.replace(/[?#].*/,"").lastIndexOf("/")+1):"",r=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},d&&(o=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=(e,t,n)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status||0==i.status&&i.response?t(i.response):n()},i.onerror=n,i.send(null)}),a.print||console.log.bind(console);var A,_,g=a.printErr||console.warn.bind(console);Object.assign(a,l),l=null,a.arguments&&(u=a.arguments),a.thisProgram&&a.thisProgram,a.quit&&a.quit,a.wasmBinary&&(A=a.wasmBinary),a.noExitRuntime,"object"!=typeof WebAssembly&&W("no native wasm support detected");var m,b,y,k,P,E=!1,w="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function M(e,t){return e?function(e,t,n){for(var i=t+n,a=t;e[a]&&!(a>=i);)++a;if(a-t>16&&e.buffer&&w)return w.decode(e.subarray(t,a));for(var r="";t<a;){var s=e[t++];if(128&s){var o=63&e[t++];if(192!=(224&s)){var c=63&e[t++];if((s=224==(240&s)?(15&s)<<12|o<<6|c:(7&s)<<18|o<<12|c<<6|63&e[t++])<65536)r+=String.fromCharCode(s);else{var h=s-65536;r+=String.fromCharCode(55296|h>>10,56320|1023&h)}}else r+=String.fromCharCode((31&s)<<6|o)}else r+=String.fromCharCode(s)}return r}(y,e,t):""}function R(e){m=e,a.HEAP8=b=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=k=new Int32Array(e),a.HEAPU8=y=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=P=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}a.INITIAL_MEMORY;var H,U,I,F=[],B=[],C=[],x=0,S=null,D=null;function W(e){a.onAbort&&a.onAbort(e),g(e="Aborted("+e+")"),E=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function T(e){return e.startsWith("data:application/octet-stream;base64,")}function q(e){return e.startsWith("file://")}function N(e){try{if(e==U&&A)return new Uint8Array(A);if(o)return o(e);throw"both async and sync fetching of the wasm failed"}catch(e){W(e)}}function L(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function z(e){for(;e.length>0;)e.shift()(a)}function j(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){P[this.ptr+4>>2]=e},this.get_type=function(){return P[this.ptr+4>>2]},this.set_destructor=function(e){P[this.ptr+8>>2]=e},this.get_destructor=function(){return P[this.ptr+8>>2]},this.set_refcount=function(e){k[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,b[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=b[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,b[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=b[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=k[this.ptr>>2];k[this.ptr>>2]=e+1},this.release_ref=function(){var e=k[this.ptr>>2];return k[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){P[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return P[this.ptr+16>>2]},this.get_exception_ptr=function(){if(re(this.get_type()))return P[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function O(e){try{return _.grow(e-m.byteLength+65535>>>16),R(_.buffer),1}catch(e){}}function G(e){return a["_"+e]}function V(e,t,n,i,a){var r={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function(e,t,n){!function(e,t,n,i){if(!(i>0))return 0;for(var a=n+i-1,r=0;r<e.length;++r){var s=e.charCodeAt(r);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++r)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0}(e,y,t,n)}(e,t=ae(n),n)}return t},array:e=>{var t=ae(e.length);return function(e,t){b.set(e,t)}(e,t),t}},s=G(e),o=[],c=0;if(i)for(var h=0;h<i.length;h++){var l=r[n[h]];l?(0===c&&(c=ne()),o[h]=l(i[h])):o[h]=i[h]}return function(e){return 0!==c&&ie(c),function(e){return"string"===t?M(e):"boolean"===t?Boolean(e):e}(e)}(s.apply(null,o))}function Z(e,t){e<128?t.push(e):t.push(e%128|128,e>>7)}a.locateFile?T(U="reading.wasm")||(I=U,U=a.locateFile?a.locateFile(I,v):v+I):U=new URL("reading.wasm",void 0).toString();var X=[];function $(e){var t=X[e];return t||(e>=X.length&&(X.length=e+1),X[e]=t=H.get(e)),t}var Y=void 0,J=[];function K(e,t){H.set(e,t),X[e]=H.get(e)}var Q,ee={b:function(e){return te(e+24)+24},a:function(e,t,n){throw new j(e).init(t,n),e},d:function(){return!0},c:function(){W("")},f:f?()=>{var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:()=>performance.now(),g:function(e,t,n){y.copyWithin(e,t,t+n)},e:function(e){var t,n=y.length,i=2147483648;if((e>>>=0)>i)return!1;for(var a=1;a<=4;a*=2){var r=n*(1+.2/a);if(r=Math.min(r,e+100663296),O(Math.min(i,(t=Math.max(e,r))+(65536-t%65536)%65536)))return!0}return!1}},te=(function(){var e={a:ee};function t(e,t){var n,i=e.exports;a.asm=i,R((_=a.asm.h).buffer),H=a.asm.l,n=a.asm.i,B.unshift(n),function(e){if(x--,a.monitorRunDependencies&&a.monitorRunDependencies(x),0==x&&(null!==S&&(clearInterval(S),S=null),D)){var t=D;D=null,t()}}()}function n(e){t(e.instance)}function r(t){return function(){if(!A&&(p||d)){if("function"==typeof fetch&&!q(U))return fetch(U,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+U+"'";return e.arrayBuffer()})).catch((function(){return N(U)}));if(s)return new Promise((function(e,t){s(U,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return N(U)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){g("failed to asynchronously prepare wasm: "+e),W(e)}))}if(x++,a.monitorRunDependencies&&a.monitorRunDependencies(x),a.instantiateWasm)try{return a.instantiateWasm(e,t)}catch(e){g("Module.instantiateWasm callback failed with error: "+e),i(e)}(A||"function"!=typeof WebAssembly.instantiateStreaming||T(U)||q(U)||f||"function"!=typeof fetch?r(n):fetch(U,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return g("wasm streaming compile failed: "+e),g("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(i)}(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.i).apply(null,arguments)},a.__ZN2ec9streaming7reading14initialise_apiEv=function(){return(a.__ZN2ec9streaming7reading14initialise_apiEv=a.asm.j).apply(null,arguments)},a.__ZN2ec9streaming7reading25create_interface_instanceEv=function(){return(a.__ZN2ec9streaming7reading25create_interface_instanceEv=a.asm.k).apply(null,arguments)},a._initialise_reading_api=function(){return(a._initialise_reading_api=a.asm.m).apply(null,arguments)},a._create_reader_instance=function(){return(a._create_reader_instance=a.asm.n).apply(null,arguments)},a._release_reader_instance=function(){return(a._release_reader_instance=a.asm.o).apply(null,arguments)},a._reader_default_config=function(){return(a._reader_default_config=a.asm.p).apply(null,arguments)},a._reader_open=function(){return(a._reader_open=a.asm.q).apply(null,arguments)},a._reader_seek=function(){return(a._reader_seek=a.asm.r).apply(null,arguments)},a._reader_enable_channel_representations=function(){return(a._reader_enable_channel_representations=a.asm.s).apply(null,arguments)},a._reader_finished_with_block=function(){return(a._reader_finished_with_block=a.asm.t).apply(null,arguments)},a._reader_read_complete=function(){return(a._reader_read_complete=a.asm.u).apply(null,arguments)},a._reader_read_failed=function(){return(a._reader_read_failed=a.asm.v).apply(null,arguments)},a._reader_close=function(){return(a._reader_close=a.asm.w).apply(null,arguments)},a._malloc=function(){return(te=a._malloc=a.asm.x).apply(null,arguments)}),ne=(a._free=function(){return(a._free=a.asm.y).apply(null,arguments)},a.stackSave=function(){return(ne=a.stackSave=a.asm.z).apply(null,arguments)}),ie=a.stackRestore=function(){return(ie=a.stackRestore=a.asm.A).apply(null,arguments)},ae=a.stackAlloc=function(){return(ae=a.stackAlloc=a.asm.B).apply(null,arguments)},re=a.___cxa_is_pointer_type=function(){return(re=a.___cxa_is_pointer_type=a.asm.C).apply(null,arguments)};function se(e){function n(){Q||(Q=!0,a.calledRun=!0,E||(z(B),t(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),C.unshift(e);var e;z(C)}()))}e=e||u,x>0||(function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),F.unshift(e);var e;z(F)}(),x>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),n()}),1)):n()))}if(a.UTF8ToString=M,a.ccall=V,a.cwrap=function(e,t,n,i){var a=(n=n||[]).every((e=>"number"===e||"boolean"===e));return"string"!==t&&a&&!i?G(e):function(){return V(e,t,n,arguments)}},a.addFunction=function(e,t){if(Y||(Y=new WeakMap,function(e,t){if(Y)for(var n=0;n<0+t;n++){var i=$(n);i&&Y.set(i,n)}}(0,H.length)),Y.has(e))return Y.get(e);var n=function(){if(J.length)return J.pop();try{H.grow(1)}catch(e){if(!(e instanceof RangeError))throw e;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return H.length-1}();try{K(n,e)}catch(i){if(!(i instanceof TypeError))throw i;K(n,function(e,t){if("function"==typeof WebAssembly.Function)return new WebAssembly.Function(function(e){for(var t={i:"i32",j:"i32",f:"f32",d:"f64",p:"i32"},n={parameters:[],results:"v"==e[0]?[]:[t[e[0]]]},i=1;i<e.length;++i)n.parameters.push(t[e[i]]),"j"===e[i]&&n.parameters.push("i32");return n}(t),e);var n=[1];!function(e,t){var n=e.slice(0,1),i=e.slice(1),a={i:127,p:127,j:126,f:125,d:124};t.push(96),Z(i.length,t);for(var r=0;r<i.length;++r)t.push(a[i[r]]);"v"==n?t.push(0):t.push(1,a[n])}(t,n);var i=[0,97,115,109,1,0,0,0,1];Z(n.length,i),i.push.apply(i,n),i.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var a=new WebAssembly.Module(new Uint8Array(i));return new WebAssembly.Instance(a,{e:{f:e}}).exports.f}(e,t))}return Y.set(e,n),n},a.removeFunction=function(e){Y.delete($(e)),J.push(e)},D=function e(){Q||se(),Q||(D=e)},a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return se(),e.ready};class t{reader_default_config(e){const t=this.nativeApi.stackSave(),n=this.nativeApi.stackAlloc(40);this.nativeApi.ccall("reader_default_config","number",["number","number"],[n,e]);const i={initialRequestDuration:this.nativeApi.HEAPF64[0+(n>>3)],maxRequestDuration:this.nativeApi.HEAPF64[1+(n>>3)],initialCacheDuration:this.nativeApi.HEAPF64[2+(n>>3)],maxCacheAheadDuration:this.nativeApi.HEAPF64[3+(n>>3)],maxCacheMemorySize:this.nativeApi.HEAPU32[8+(n>>2)],formatGuess:this.nativeApi.HEAPU32[9+(n>>2)],debugLogging:0!=this.nativeApi.HEAPU8[n+40],requestMetaData:0!=this.nativeApi.HEAPU8[n+41]};return this.nativeApi.stackRestore(t),i}reader_open(e,t,n){const i=this.nativeApi.stackSave(),a=this.nativeApi.stackAlloc(40);this.nativeApi.HEAPF64[0+(a>>3)]=t.initialRequestDuration,this.nativeApi.HEAPF64[1+(a>>3)]=t.maxRequestDuration,this.nativeApi.HEAPF64[2+(a>>3)]=t.initialCacheDuration,this.nativeApi.HEAPF64[3+(a>>3)]=t.maxCacheAheadDuration,this.nativeApi.HEAPU32[8+(a>>2)]=t.maxCacheMemorySize,this.nativeApi.HEAPU32[9+(a>>2)]=t.formatGuess,this.nativeApi.HEAPU8[a+40]=t.debugLogging?1:0,this.nativeApi.HEAPU8[a+41]=t.requestMetaData?1:0;const r=this.nativeApi.stackAlloc(52);this.nativeApi.HEAPU32[0+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{n.onEvent(t)}),"vii"),this.nativeApi.HEAPU32[1+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{const i={duration:this.nativeApi.HEAPF64[t>>3],channelCount:this.nativeApi.HEAPU32[2+(t>>2)]};n.onPlaybackInfoReceived(i)}),"vii"),this.nativeApi.HEAPU32[2+(r>>2)]=this.nativeApi.addFunction(((e,t,i,a)=>{const r=new Map;for(let e=0;e<t;++e){const t=this.nativeApi.HEAPU32[(i>>2)+e],n=this.nativeApi.UTF8ToString(t),s=this.nativeApi.HEAPU32[(a>>2)+e],o=this.nativeApi.UTF8ToString(s);r.set(n,o)}n.onMetaDataReceived(r)}),"viiii"),this.nativeApi.HEAPU32[3+(r>>2)]=this.nativeApi.addFunction(((e,t,i)=>{const a=[];for(let e=0;e<t;++e){const t=i+112*e,n=this.nativeApi.HEAPU32[26+(t>>2)],r=this.nativeApi.HEAPU32[27+(t>>2)],s=[];for(let e=0;e<n;++e){const t=r+24*e,n=[],i=this.nativeApi.HEAPU32[3+(t>>2)],a=this.nativeApi.HEAPU32[4+(t>>2)];if(i>0&&a>0)for(let e=0;e<i;++e)n.push(this.nativeApi.HEAPU32[(a>>2)+e]);const o=this.nativeApi.HEAP32[5+(t>>2)];let c="";o&&(c=this.nativeApi.UTF8ToString(o)),s.push({representationId:this.nativeApi.HEAPU32[0+(t>>2)],bitRate:this.nativeApi.HEAPU32[1+(t>>2)],sampleRate:this.nativeApi.HEAPU32[2+(t>>2)],levelOfDetails:n,externalPostfix:c})}a.push({channelId:this.nativeApi.HEAPU32[0+(t>>2)],description:this.nativeApi.UTF8ToString(t+4),origin:{x:this.nativeApi.HEAPF32[9+(t>>2)],y:this.nativeApi.HEAPF32[10+(t>>2)],z:this.nativeApi.HEAPF32[11+(t>>2)]},rotation:{x:this.nativeApi.HEAPF32[12+(t>>2)],y:this.nativeApi.HEAPF32[13+(t>>2)],z:this.nativeApi.HEAPF32[14+(t>>2)],w:this.nativeApi.HEAPF32[15+(t>>2)]},aabb:{min:{x:this.nativeApi.HEAPF32[16+(t>>2)],y:this.nativeApi.HEAPF32[17+(t>>2)],z:this.nativeApi.HEAPF32[18+(t>>2)]},max:{x:this.nativeApi.HEAPF32[19+(t>>2)],y:this.nativeApi.HEAPF32[20+(t>>2)],z:this.nativeApi.HEAPF32[21+(t>>2)]}},startTime:this.nativeApi.HEAPF64[11+(t>>3)],duration:this.nativeApi.HEAPF64[12+(t>>3)],representations:s})}n.onChannelReceived(a)}),"viii"),this.nativeApi.HEAPU32[4+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{n.onNextBlockNotReady(t)}),"vii"),this.nativeApi.HEAPU32[5+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{const i={cacheId:this.nativeApi.HEAPU32[0+(t>>2)],blockId:this.nativeApi.HEAPU32[1+(t>>2)],channelId:this.nativeApi.HEAPU32[2+(t>>2)],representationId:this.nativeApi.HEAPU32[3+(t>>2)],bitRate:this.nativeApi.HEAPU32[4+(t>>2)],timestamp:this.nativeApi.HEAPF64[3+(t>>3)],duration:this.nativeApi.HEAPF64[4+(t>>3)],offset:this.nativeApi.HEAPU32[10+(t>>2)],size:this.nativeApi.HEAPU32[11+(t>>2)]};n.onBlockReceived(i)}),"vii"),this.nativeApi.HEAPU32[6+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{n.onBlockInvalidated(t)}),"vii"),this.nativeApi.HEAPU32[7+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{n.onLastBlock(t)}),"vii"),this.nativeApi.HEAPU32[8+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{n.onCacheUpdate(t)}),"vid"),this.nativeApi.HEAPU32[9+(r>>2)]=this.nativeApi.addFunction(((e,t)=>{const i=new Uint32Array([t])[0];n.onFinishedWithCacheId(i)}),"vii"),this.nativeApi.HEAPU32[10+(r>>2)]=this.nativeApi.addFunction(((e,t,i)=>{let a=null;return i&&(a=this.nativeApi.UTF8ToString(i)),n.openConnection(t,a)}),"iiii"),this.nativeApi.HEAPU32[11+(r>>2)]=this.nativeApi.addFunction(((e,t,i)=>{const a=this.nativeApi.HEAPU32[4+(i>>2)],r=this.nativeApi.HEAPU32[5+(i>>2)],s=Math.pow(2,32),o={requestId:this.nativeApi.HEAPU32[0+(i>>2)],cacheId:this.nativeApi.HEAPU32[1+(i>>2)],buffer:this.nativeApi.HEAPU32[2+(i>>2)],offset:a+r*s,size:this.nativeApi.HEAPU32[6+(i>>2)]};return n.readFromConnection(t,o)}),"iiii"),this.nativeApi.HEAPU32[12+(r>>2)]=this.nativeApi.addFunction(((e,t)=>n.closeConnection(t)),"iii");const s=this.nativeApi.ccall("reader_open","number",["number","number","number"],[e,a,r]);return this.nativeApi.stackRestore(i),s}render_enable_channel_representations(e,t,n,i){const a=this.nativeApi.stackSave(),r=this.nativeApi.stackAlloc(4*n.length);n.forEach(((e,t)=>{this.nativeApi.HEAPU32[(r>>2)+t]=e})),this._render_enable_channel_representations(e,t,n.length,r,i),this.nativeApi.stackRestore(a)}transfer(e,t,n){e.byteLength>=n&&this.nativeApi.HEAPU8.set(e,t)}constructor(e){this.nativeApi=e,e.ccall("initialise_reading_api",null,null,null),this.create_reader_instance=e.cwrap("create_reader_instance","number",null),this.release_reader_instance=e.cwrap("release_reader_instance","number",["number"]),this.reader_seek=e.cwrap("reader_seek",null,["number","number"]),this._render_enable_channel_representations=e.cwrap("reader_enable_channel_representations",null,["number","number","number","number","boolean"]),this.reader_finished_with_block=e.cwrap("reader_finished_with_block",null,["number","number"]),this.reader_read_complete=e.cwrap("reader_read_complete",null,["number","number"]),this.reader_read_failed=e.cwrap("reader_read_failed",null,["number","number"]),this.reader_close=e.cwrap("reader_close",null,["number"])}}class i{constructor(){this.entries=new Map}add(e,t){this.entries.set(e,t)}remove(e){return this.entries.delete(e)}get(e){const t=this.entries.get(e.cacheId);if(t)return t.slice(e.offset,e.offset+e.size)}clear(){this.entries=new Map}}class a{constructor(e){this.handle=0,this.api=e,this.handle=this.api.create_reader_instance()}defaultConfig(){return this.api.reader_default_config(this.handle)}open(e,t){return this.delegate=t,this.api.reader_open(this.handle,e,this.delegate)}seek(e){this.api.reader_seek(this.handle,e)}enableChannelRepresentations(e,t,n){this.api.render_enable_channel_representations(this.handle,e,t,n)}finishedWithBlock(e){this.api.reader_finished_with_block(this.handle,e)}completeRequest(e,t){if(0!=e.cacheId)this.api.reader_read_complete(this.handle,e.requestId);else if(!t||t.byteLength<e.size)this.api.reader_read_failed(this.handle,e.requestId);else{const n=new Uint8Array(t);this.api.transfer(n,e.buffer,e.size),this.api.reader_read_complete(this.handle,e.requestId)}}failRequest(e){this.api.reader_read_failed(this.handle,e.requestId)}close(){this.api.reader_close(this.handle)}release(){this.api.release_reader_instance(this.handle),this.handle=0}}class r{constructor(e){this.nativeApi=e,this.readerApi=new t(this.nativeApi)}createReader(){return new a(this.readerApi)}}let s=null;var o;!function(e){var t;(t=e.Msg||(e.Msg={})).connectMsg=function(e){return{type:0,port:e}},t.openStreamMsg=function(e,t){return{type:1,path:e,config:t}},t.readEventMsg=function(e){return{type:2,event:e}},t.seekMsg=function(e){return{type:3,time:e}},t.metaDataMsg=function(e){return{type:4,metaData:e}},t.resetMsg=function(){return{type:5}},t.channelInfosMsg=function(e){return{type:6,infos:e}},t.playbackInfoMsg=function(e){return{type:7,info:e}},t.enableChannelRepresentationsMsg=function(e){return{type:8,enable:e}},t.channelBlockMsg=function(e,t){return{type:9,block:e,buffer:t}},t.decodedFrameMsg=function(e){return{type:10,frame:e}},t.finishedWithBlockMsg=function(e){return{type:11,blockId:e}},t.finishedWithVolumetricFrameMsg=function(e,t){return{type:12,coordBuffer:e,colourBuffer:t}},t.blockInvalidatedMsg=function(e){return{type:13,blockId:e}},t.nextBlockNotReadyMsg=function(e){return{type:14,channelId:e}},t.decodeConfigMsg=function(e){return{type:15,config:e}},t.setLODProfileMsg=function(e){return{type:16,profile:e}},t.cacheUpdateMsg=function(e){return{type:17,cachedUntil:e}}}(o||(o={}));const c=self;class h{constructor(e){this.url=e}request(e,t,n){const i=e.offset,a=e.offset+e.size-1,r={mode:"cors",headers:new Headers({Range:`bytes=${i}-${a}`}),keepalive:!0};fetch(this.url.toString(),r).then((e=>e.arrayBuffer())).then((i=>{e.buffer?t.completeRequest(e,i):0!=e.cacheId?(n.add(e.cacheId,i),t.completeRequest(e)):t.failRequest(e)})).catch((()=>{t.failRequest(e)}))}}class l{constructor(e,t,n){this.onEvent=e=>{this.callbacks.onEvent(e)},this.onMetaDataReceived=e=>{this.callbacks.onMetaDataReceived(e)},this.onChannelReceived=e=>{this.callbacks.onChannelInfosReceived(e)},this.onPlaybackInfoReceived=e=>{this.callbacks.onPlaybackInfoReceived(e)},this.onNextBlockNotReady=e=>{this.callbacks.onNextBlockNotReady(e)},this.onBlockReceived=e=>{const t=this.cache.get(e);t&&this.callbacks.onBlockReceived(e,t)},this.onBlockInvalidated=e=>{this.callbacks.onBlockInvalidated(e)},this.onLastBlock=e=>{this.callbacks.onLastBlock(e)},this.onCacheUpdate=e=>{this.callbacks.onCacheUpdate(e)},this.onFinishedWithCacheId=e=>{this.cache.remove(e)||console.error("cache id not found")},this.openConnection=(e,t)=>{if(this.connections.has(e))return!1;let n=t;n||(n=this.rootFilename);const i=this.rootUrl+n;return this.connections.set(e,new h(i)),!0},this.readFromConnection=(e,t)=>{const n=this.connections.get(e);return!!n&&(n.request(t,this.reader,this.cache),!0)},this.closeConnection=e=>!!this.connections.has(e)&&(this.connections.delete(e),!0),this.reader=e,this.cache=new i,this.callbacks=n;const a=t.lastIndexOf("/")+1;this.rootUrl=t.slice(0,a),this.rootFilename=t.slice(a),this.connections=new Map}}const u=new class{constructor(){this.loadMetaData=!1,this.frameSkip=0,this.currentSkip=0,this.onEvent=e=>{this._decodePort?this._decodePort.postMessage(o.Msg.readEventMsg(e)):c.postMessage(o.Msg.readEventMsg(e))},this.onMetaDataReceived=e=>{c.postMessage(o.Msg.metaDataMsg(e))},this.onChannelInfosReceived=e=>{e.forEach((e=>{(e.description.startsWith("volumetric")||e.description.startsWith("mesh"))&&this.geoChannels.push(e.channelId)})),c.postMessage(o.Msg.channelInfosMsg(e))},this.onPlaybackInfoReceived=e=>{c.postMessage(o.Msg.playbackInfoMsg(e))},this.onNextBlockNotReady=e=>{this._decodePort&&this._decodePort.postMessage(o.Msg.nextBlockNotReadyMsg(e)),c.postMessage(o.Msg.nextBlockNotReadyMsg(e))},this.onBlockReceived=(e,t)=>{const n=o.Msg.channelBlockMsg(e,t);if(this.geoChannels.includes(e.channelId)){if(!this._decodePort)return;if(this.frameSkip>0){const e=this.currentSkip;if(this.currentSkip=(this.currentSkip+1)%(this.frameSkip+1),0!=e)return void this.finishedWithBlock(n.block.blockId);n.block.duration*=this.frameSkip+1}this.activeVolumetricBlocks.push(e.blockId),this._decodePort.postMessage(n,[t])}else c.postMessage(n,[t])},this.onBlockInvalidated=e=>{this.activeVolumetricBlocks.includes(e)&&this._decodePort?this._decodePort.postMessage(o.Msg.blockInvalidatedMsg(e)):c.postMessage(o.Msg.blockInvalidatedMsg(e))},this.onLastBlock=e=>{},this.onCacheUpdate=e=>{c.postMessage(o.Msg.cacheUpdateMsg(e))},this.onMessage=e=>{switch(e.data.type){case 0:{const t=e.data;this.decodePort=t.port;break}case 1:{const t=e.data;this.open(t.path,t.config);break}case 3:{const t=e.data;this.seek(t.time);break}case 8:e.data.enable.forEach((e=>{this.reader?.enableChannelRepresentations(e.channelId,e.representationIds,e.clearCache)}));break;case 11:{const t=e.data;this.finishedWithBlock(t.blockId);break}}},this.reader=null,this.path=null,this._decodePort=null,this.geoChannels=[],this.activeVolumetricBlocks=[],function(t="./"){return s?Promise.resolve(s):new Promise((n=>{e({locateFile:e=>t+e}).then((e=>{s=new r(e),n(s)}))}))}(workerRoot).then((e=>{this.reader=e.createReader(),this.path&&this.open(this.path,this.loadMetaData)}))}set decodePort(e){this._decodePort=e,this._decodePort.onmessage=this.onMessage}open(e,t){if(this.path=e,"boolean"==typeof t?this.loadMetaData=t:this.config=t,!this.reader)return;void 0===this.config&&(this.config=this.reader.defaultConfig(),this.config.requestMetaData=this.loadMetaData);const n=new l(this.reader,e,{onEvent:this.onEvent,onMetaDataReceived:this.onMetaDataReceived,onChannelInfosReceived:this.onChannelInfosReceived,onPlaybackInfoReceived:this.onPlaybackInfoReceived,onNextBlockNotReady:this.onNextBlockNotReady,onBlockReceived:this.onBlockReceived,onLastBlock:this.onLastBlock,onBlockInvalidated:this.onBlockInvalidated,onCacheUpdate:this.onCacheUpdate});this.reader.open(this.config,n)||console.log(`failed to open ecv stream ${this.path}`)}seek(e){this.reader&&this.reader.seek(e)}finishedWithBlock(e){this.reader&&this.reader.finishedWithBlock(e)}};c.onmessage=u.onMessage})()})();