(()=>{var e={723:()=>{},280:()=>{}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}(()=>{"use strict";const e=function(e){var t,i,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(e,n){t=e,i=n}));var o,s,a,c,d,u=Object.assign({},r),f=[],l="object"==typeof window,_="function"==typeof importScripts,h="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,p="";h?(p=_?n(280).dirname(p)+"/":"//",c=n(723),d=n(280),o=(e,t)=>(e=d.normalize(e),c.readFileSync(e,t?void 0:"utf8")),a=e=>{var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),t},s=(e,t,n)=>{e=d.normalize(e),c.readFile(e,(function(e,i){e?n(e):t(i.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),f=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof W))throw e})),process.on("unhandledRejection",(function(e){throw e})),r.inspect=function(){return"[Emscripten Module object]"}):(l||_)&&(_?p=self.location.href:"undefined"!=typeof document&&document.currentScript&&(p=document.currentScript.src),p=0!==p.indexOf("blob:")?p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},_&&(a=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=(e,t,n)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status||0==i.status&&i.response?t(i.response):n()},i.onerror=n,i.send(null)});var m,g,v=r.print||console.log.bind(console),b=r.printErr||console.warn.bind(console);Object.assign(r,u),u=null,r.arguments&&(f=r.arguments),r.thisProgram&&r.thisProgram,r.quit&&r.quit,r.wasmBinary&&(m=r.wasmBinary),r.noExitRuntime,"object"!=typeof WebAssembly&&L("no native wasm support detected");var y,A,x,E,w,k=!1,P="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function M(e,t,n){for(var i=t+n,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.buffer&&P)return P.decode(e.subarray(t,r));for(var o="";t<r;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var c=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var d=s-65536;o+=String.fromCharCode(55296|d>>10,56320|1023&d)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o}function B(e){y=e,r.HEAP8=A=new Int8Array(e),r.HEAP16=new Int16Array(e),r.HEAP32=E=new Int32Array(e),r.HEAPU8=x=new Uint8Array(e),r.HEAPU16=new Uint16Array(e),r.HEAPU32=w=new Uint32Array(e),r.HEAPF32=new Float32Array(e),r.HEAPF64=new Float64Array(e)}r.INITIAL_MEMORY;var D,F,I=[],H=[],R=[],C=0,S=null,U=null;function L(e){r.onAbort&&r.onAbort(e),b(e="Aborted("+e+")"),k=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function T(e){return e.startsWith("data:application/octet-stream;base64,")}function N(e){return e.startsWith("file://")}function O(e){try{if(e==D&&m)return new Uint8Array(m);if(a)return a(e);throw"both async and sync fetching of the wasm failed"}catch(e){L(e)}}function W(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function z(e){for(;e.length>0;)e.shift()(r)}function j(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){w[this.ptr+4>>2]=e},this.get_type=function(){return w[this.ptr+4>>2]},this.set_destructor=function(e){w[this.ptr+8>>2]=e},this.get_destructor=function(){return w[this.ptr+8>>2]},this.set_refcount=function(e){E[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,A[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=A[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,A[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=A[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=E[this.ptr>>2];E[this.ptr>>2]=e+1},this.release_ref=function(){var e=E[this.ptr>>2];return E[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){w[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return w[this.ptr+16>>2]},this.get_exception_ptr=function(){if(te(this.get_type()))return w[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function Z(e){try{return g.grow(e-y.byteLength+65535>>>16),B(g.buffer),1}catch(e){}}r.locateFile?T(D="decoding.wasm")||(F=D,D=r.locateFile?r.locateFile(F,p):p+F):D=new URL("decoding.wasm",void 0).toString();var q=[null,[],[]];function Y(e,t){var n=q[e];0===t||10===t?((1===e?v:b)(M(n,0)),n.length=0):n.push(t)}function X(e){return r["_"+e]}function V(e,t,n,i,r){var o={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function(e,t,n){!function(e,t,n,i){if(!(i>0))return 0;for(var r=n+i-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=r)break;t[n++]=s}else if(s<=2047){if(n+1>=r)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=r)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=r)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0}(e,x,t,n)}(e,t=ee(n),n)}return t},array:e=>{var t=ee(e.length);return function(e,t){A.set(e,t)}(e,t),t}},s=X(e),a=[],c=0;if(i)for(var d=0;d<i.length;d++){var u=o[n[d]];u?(0===c&&(c=Q()),a[d]=u(i[d])):a[d]=i[d]}return function(e){return 0!==c&&$(c),function(e){return"string"===t?(n=e)?M(x,n,void 0):"":"boolean"===t?Boolean(e):e;var n}(e)}(s.apply(null,a))}var G,J={b:function(e){return K(e+24)+24},a:function(e,t,n){throw new j(e).init(t,n),e},e:function(){return!0},c:function(){L("")},f:function(){return Date.now()},h:h?()=>{var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:()=>performance.now(),i:function(e,t,n){x.copyWithin(e,t,t+n)},g:function(e){var t,n=x.length,i=2147483648;if((e>>>=0)>i)return!1;for(var r=1;r<=4;r*=2){var o=n*(1+.2/r);if(o=Math.min(o,e+100663296),Z(Math.min(i,(t=Math.max(e,o))+(65536-t%65536)%65536)))return!0}return!1},d:function(e,t,n,i){for(var r=0,o=0;o<n;o++){var s=w[t>>2],a=w[t+4>>2];t+=8;for(var c=0;c<a;c++)Y(e,x[s+c]);r+=a}return w[i>>2]=r,0}},K=(function(){var e={a:J};function t(e,t){var n,i=e.exports;r.asm=i,B((g=r.asm.j).buffer),r.asm.p,n=r.asm.k,H.unshift(n),function(e){if(C--,r.monitorRunDependencies&&r.monitorRunDependencies(C),0==C&&(null!==S&&(clearInterval(S),S=null),U)){var t=U;U=null,t()}}()}function n(e){t(e.instance)}function o(t){return function(){if(!m&&(l||_)){if("function"==typeof fetch&&!N(D))return fetch(D,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+D+"'";return e.arrayBuffer()})).catch((function(){return O(D)}));if(s)return new Promise((function(e,t){s(D,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return O(D)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){b("failed to asynchronously prepare wasm: "+e),L(e)}))}if(C++,r.monitorRunDependencies&&r.monitorRunDependencies(C),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){b("Module.instantiateWasm callback failed with error: "+e),i(e)}(m||"function"!=typeof WebAssembly.instantiateStreaming||T(D)||N(D)||h||"function"!=typeof fetch?o(n):fetch(D,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return b("wasm streaming compile failed: "+e),b("falling back to ArrayBuffer instantiation"),o(n)}))}))).catch(i)}(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.k).apply(null,arguments)},r.__ZN2ec6codecs8decoding37initialise_internal_services_registryEPv=function(){return(r.__ZN2ec6codecs8decoding37initialise_internal_services_registryEPv=r.asm.l).apply(null,arguments)},r.__ZN2ec6codecs8decoding14initialise_apiEv=function(){return(r.__ZN2ec6codecs8decoding14initialise_apiEv=r.asm.m).apply(null,arguments)},r.__ZN2ec6codecs8decoding16deinitialise_apiEv=function(){return(r.__ZN2ec6codecs8decoding16deinitialise_apiEv=r.asm.n).apply(null,arguments)},r.__ZN2ec6codecs8decoding25create_interface_instanceEv=function(){return(r.__ZN2ec6codecs8decoding25create_interface_instanceEv=r.asm.o).apply(null,arguments)},r._initialise_decoding_api=function(){return(r._initialise_decoding_api=r.asm.q).apply(null,arguments)},r._deinitialise_decoding_api=function(){return(r._deinitialise_decoding_api=r.asm.r).apply(null,arguments)},r._create_decoder_instance=function(){return(r._create_decoder_instance=r.asm.s).apply(null,arguments)},r._release_decoder_instance=function(){return(r._release_decoder_instance=r.asm.t).apply(null,arguments)},r._decoder_open=function(){return(r._decoder_open=r.asm.u).apply(null,arguments)},r._decoder_default_decode_definition=function(){return(r._decoder_default_decode_definition=r.asm.v).apply(null,arguments)},r._decoder_decode=function(){return(r._decoder_decode=r.asm.w).apply(null,arguments)},r._decoder_get_maximum_header_read_size=function(){return(r._decoder_get_maximum_header_read_size=r.asm.x).apply(null,arguments)},r._decoder_get_frame_header_info=function(){return(r._decoder_get_frame_header_info=r.asm.y).apply(null,arguments)},r._decoder_get_voxel_frame=function(){return(r._decoder_get_voxel_frame=r.asm.z).apply(null,arguments)},r._decoder_close=function(){return(r._decoder_close=r.asm.A).apply(null,arguments)},r._release_voxel_frame_instance=function(){return(r._release_voxel_frame_instance=r.asm.B).apply(null,arguments)},r._voxel_frame_get_definition=function(){return(r._voxel_frame_get_definition=r.asm.C).apply(null,arguments)},r._voxel_frame_get_coordinates=function(){return(r._voxel_frame_get_coordinates=r.asm.D).apply(null,arguments)},r._voxel_frame_get_colours=function(){return(r._voxel_frame_get_colours=r.asm.E).apply(null,arguments)},r._voxel_frame_copy_coordinates=function(){return(r._voxel_frame_copy_coordinates=r.asm.F).apply(null,arguments)},r._voxel_frame_copy_colours=function(){return(r._voxel_frame_copy_colours=r.asm.G).apply(null,arguments)},r._release_frame_header_info_instance=function(){return(r._release_frame_header_info_instance=r.asm.H).apply(null,arguments)},r._frame_header_info_get_info=function(){return(r._frame_header_info_get_info=r.asm.I).apply(null,arguments)},r._frame_header_info_level_voxel_counts=function(){return(r._frame_header_info_level_voxel_counts=r.asm.J).apply(null,arguments)},r._malloc=function(){return(K=r._malloc=r.asm.K).apply(null,arguments)}),Q=(r._free=function(){return(r._free=r.asm.L).apply(null,arguments)},r.stackSave=function(){return(Q=r.stackSave=r.asm.M).apply(null,arguments)}),$=r.stackRestore=function(){return($=r.stackRestore=r.asm.N).apply(null,arguments)},ee=r.stackAlloc=function(){return(ee=r.stackAlloc=r.asm.O).apply(null,arguments)},te=r.___cxa_is_pointer_type=function(){return(te=r.___cxa_is_pointer_type=r.asm.P).apply(null,arguments)};function ne(e){function n(){G||(G=!0,r.calledRun=!0,k||(z(H),t(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),R.unshift(e);var e;z(R)}()))}e=e||f,C>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),I.unshift(e);var e;z(I)}(),C>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),n()}),1)):n()))}if(r.ccall=V,r.cwrap=function(e,t,n,i){var r=(n=n||[]).every((e=>"number"===e||"boolean"===e));return"string"!==t&&r&&!i?X(e):function(){return V(e,t,n,arguments)}},U=function e(){G||ne(),G||(U=e)},r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return ne(),e.ready};class t{decoder_open(e,t){var n=new Uint8Array(t);return(this.streamBufferSize<n.byteLength||0==this.streamBuffer)&&(this.streamBuffer=this.nativeApi._malloc(n.byteLength),this.streamBufferSize=n.byteLength),this.nativeApi.HEAPU8.set(n,this.streamBuffer),this._decoder_open(e,this.streamBuffer,n.byteLength)}decoder_default_decode_definition(e){const t=this.nativeApi.stackSave(),n=this.nativeApi.stackAlloc(16);this.nativeApi.ccall("decoder_default_decode_definition","number",["number","number"],[n,e]);const i={requiredLOD:this.nativeApi.HEAPU8[n],rgbColourspaceConversion:0!=this.nativeApi.HEAP8[n+1],cartesianSpaceConversion:0!=this.nativeApi.HEAP8[n+2],fastDecode:0!=this.nativeApi.HEAP8[n+4]};return this.nativeApi.stackRestore(t),i}set_deocde_definition(e,t){this.nativeApi.HEAPU8[e]=t.requiredLOD,this.nativeApi.HEAP8[e+1]=t.rgbColourspaceConversion?1:0,this.nativeApi.HEAP8[e+2]=t.cartesianSpaceConversion?1:0,this.nativeApi.HEAP8[e+4]=t.fastDecode?1:0}decoder_create_decode_definition(e){const t=this.nativeApi._malloc(16);for(let e=0;e<16;++e)this.nativeApi.HEAPU8[t+e]=0;const n=this.decoder_default_decode_definition(e);return this.set_deocde_definition(t,n),t}voxel_frame_get_definition(e){this._voxel_frame_get_definition(e,this.voxelFrameDefinitionPtr);const t=this.voxelFrameDefinitionPtr/4;return{frameNumber:this.nativeApi.HEAPU32[t+0],voxelCount:this.nativeApi.HEAPU32[t+2],boundsMinX:this.nativeApi.HEAPF32[t+3],boundsMinY:this.nativeApi.HEAPF32[t+4],boundsMinZ:this.nativeApi.HEAPF32[t+5],boundsDim:this.nativeApi.HEAPF32[t+6],bitsPerVoxel:this.nativeApi.HEAPU32[t+7]}}voxel_frame_get_coordinates(e,t,n){const i=this._voxel_frame_get_coordinates(e)/Uint16Array.BYTES_PER_ELEMENT;if(0==i||t.byteLength<Uint16Array.BYTES_PER_ELEMENT*n)return!1;const r=i+n;return t.set(this.nativeApi.HEAPU16.subarray(i,r)),!0}voxel_frame_get_colours(e,t,n){const i=this._voxel_frame_get_colours(e)/Uint8Array.BYTES_PER_ELEMENT;if(0==i||t.byteLength<Uint8Array.BYTES_PER_ELEMENT*n)return!1;const r=i+n;return t.set(this.nativeApi.HEAPU8.subarray(i,r)),!0}frame_header_info_get(e){const t=this.nativeApi.stackSave(),n=this.nativeApi.stackAlloc(48);let i;if(this._frame_header_info_get_info(e,n)){const t=n>>2,o=this.nativeApi.HEAPU32[t+11]+1;if(o>0){const n=this.nativeApi.stackAlloc(4*o),s=this._frame_header_info_level_voxel_counts(e,n,o),a=[];for(var r=0;r<s;++r)a.push(this.nativeApi.HEAPU32[(n>>2)+r]);i={voxelCubeBoundsMinX:this.nativeApi.HEAPF32[t+0],voxelCubeBoundsMinY:this.nativeApi.HEAPF32[t+1],voxelCubeBoundsMinZ:this.nativeApi.HEAPF32[t+2],voxelCubeBoundsDim:this.nativeApi.HEAPF32[t+3],tightBoundsMinX:this.nativeApi.HEAPF32[t+4],tightBoundsMinY:this.nativeApi.HEAPF32[t+5],tightBoundsMinZ:this.nativeApi.HEAPF32[t+6],tightBoundsDimX:this.nativeApi.HEAPF32[t+7],tightBoundsDimY:this.nativeApi.HEAPF32[t+8],tightBoundsDimZ:this.nativeApi.HEAPF32[t+9],minValidLevel:this.nativeApi.HEAPU32[t+10],maxValidLevel:this.nativeApi.HEAPU32[t+11],levelVoxelCounts:a}}}return this.nativeApi.stackRestore(t),i}constructor(e){this.streamBuffer=0,this.streamBufferSize=0,this.voxelFrameDefinitionPtr=0,this.nativeApi=e,this.voxelFrameDefinitionPtr=this.nativeApi._malloc(32),e.ccall("initialise_decoding_api",null,null,null),this.create_decoder_instance=e.cwrap("create_decoder_instance","number",null),this.release_decoder_instance=e.cwrap("release_decoder_instance","number",["number"]),this._decoder_open=e.cwrap("decoder_open","number",["number","number","number"]),this.decoder_decode=e.cwrap("decoder_decode","number",["number","number"]),this.decoder_get_maximum_header_read_size=e.cwrap("decoder_get_maximum_header_read_size","number",["number"]),this.decoder_get_frame_header_info=e.cwrap("decoder_get_frame_header_info","number",["number"]),this.decoder_get_voxel_frame=e.cwrap("decoder_get_voxel_frame","number",["number"]),this.decoder_close=e.cwrap("decoder_close",null,["number"]),this.release_voxel_frame_instance=e.cwrap("release_voxel_frame_instance","number",["number"]),this._voxel_frame_get_definition=e.cwrap("voxel_frame_get_definition","number",["number","number"]),this._voxel_frame_get_coordinates=e.cwrap("voxel_frame_get_coordinates","number",["number"]),this._voxel_frame_get_colours=e.cwrap("voxel_frame_get_colours","number",["number"]),this.release_frame_header_info_instance=e.cwrap("release_frame_header_info_instance","number",["number"]),this._frame_header_info_get_info=e.cwrap("frame_header_info_get_info","number",["number","number"]),this._frame_header_info_level_voxel_counts=e.cwrap("frame_header_info_level_voxel_counts","number",["number","number","number"])}}class i{constructor(e,t){this.handle=0,this.api=e,this.handle=t,this.definition=this.api.voxel_frame_get_definition(this.handle)}elementCount(){return this.definition?3*this.definition.voxelCount:0}coordinates(e){return!!this.definition&&this.api.voxel_frame_get_coordinates(this.handle,e,this.elementCount())}colours(e){return!!this.definition&&this.api.voxel_frame_get_colours(this.handle,e,this.elementCount())}release(){return this.api.release_voxel_frame_instance(this.handle)}}class r{constructor(e){this.handle=0,this.decodeDefinition=0,this.api=e,this.handle=this.api.create_decoder_instance(),this.decodeDefinition=this.api.decoder_create_decode_definition(this.handle)}open(e){return this.api.decoder_open(this.handle,e)}close(){this.api.decoder_close(this.handle)}getDefaultDecodeDefinition(){return this.api.decoder_default_decode_definition(this.handle)}setDecodeDefinition(e){this.api.set_deocde_definition(this.decodeDefinition,e)}decode(){return this.api.decoder_decode(this.handle,this.decodeDefinition)}getMaximumHeaderReadSize(){return this.api.decoder_get_maximum_header_read_size(this.handle)}frameHeaderInfo(){const e=this.api.decoder_get_frame_header_info(this.handle);if(0!=e){const t=this.api.frame_header_info_get(e);return this.api.release_frame_header_info_instance(e),t}}voxelFrame(){return new i(this.api,this.api.decoder_get_voxel_frame(this.handle))}release(){this.api.release_decoder_instance(this.handle)}}class o{constructor(e){this.nativeApi=e,this.decodeApi=new t(this.nativeApi)}createDecoder(){return new r(this.decodeApi)}}var s;!function(e){var t;(t=e.Msg||(e.Msg={})).connectMsg=function(e){return{type:0,port:e}},t.openStreamMsg=function(e,t){return{type:1,path:e,config:t}},t.readEventMsg=function(e){return{type:2,event:e}},t.seekMsg=function(e){return{type:3,time:e}},t.metaDataMsg=function(e){return{type:4,metaData:e}},t.resetMsg=function(){return{type:5}},t.channelInfosMsg=function(e){return{type:6,infos:e}},t.playbackInfoMsg=function(e){return{type:7,info:e}},t.enableChannelRepresentationsMsg=function(e){return{type:8,enable:e}},t.channelBlockMsg=function(e,t){return{type:9,block:e,buffer:t}},t.decodedFrameMsg=function(e){return{type:10,frame:e}},t.finishedWithBlockMsg=function(e){return{type:11,blockId:e}},t.finishedWithVolumetricFrameMsg=function(e,t){return{type:12,coordBuffer:e,colourBuffer:t}},t.blockInvalidatedMsg=function(e){return{type:13,blockId:e}},t.nextBlockNotReadyMsg=function(e){return{type:14,channelId:e}},t.decodeConfigMsg=function(e){return{type:15,config:e}},t.setLODProfileMsg=function(e){return{type:16,profile:e}},t.cacheUpdateMsg=function(e){return{type:17,cachedUntil:e}}}(s||(s={}));class a{constructor(){this.BUFFER_ALLOCATION_MOD=1.1,this.buffers=[]}get(e,t){let n=this.buffers.pop();for(;n;){if(n.length>=e)return n;n=this.buffers.pop()}return new t(e*this.BUFFER_ALLOCATION_MOD)}store(e){this.buffers.push(e)}}const c=self,d=new class{constructor(){this.currentBlockId=0,this.primed=!1,this.onMessage=e=>{switch(e.data.type){case 0:{const t=e.data;this.readPort=t.port;break}case 9:{const t=e.data;this.decode(t);break}case 11:e.data,this.sendFrmae();break;case 12:{const t=e.data;t.coordBuffer&&this.coordBufferStorage.store(t.coordBuffer),t.colourBuffer&&this.colourBufferStorage.store(t.colourBuffer);break}case 13:{const t=e.data;this.pendingBlockMsg&&this.pendingBlockMsg.block.blockId==t.blockId&&(this.pendingBlockMsg=void 0),this.currentBlockId==t.blockId&&c.postMessage(s.Msg.blockInvalidatedMsg(t.blockId)),this.currentBlockId=0,this.pendingFrame=void 0;break}case 2:c.postMessage(e.data);break;case 5:this.pendingBlockMsg=void 0,this.currentBlockId=0,this.pendingFrame=void 0,c.postMessage(s.Msg.resetMsg());break;case 14:e.data;break;case 15:{const t=e.data;this.decodeConfig=t.config,this.updateDefinition();break}case 16:{const t=e.data;this.lodProfile=t.profile;break}}},this.coordBufferStorage=new a,this.colourBufferStorage=new a,function(t="./"){return new Promise((n=>{e({locateFile:e=>t+e}).then((e=>{n(new o(e))}))}))}(workerRoot).then((e=>{this.decoder=e.createDecoder(),this.decodeDefinition=this.decoder.getDefaultDecodeDefinition(),this.decodeDefinition.rgbColourspaceConversion=!1,this.decodeDefinition.fastDecode=!0,this.updateDefinition(),this.pendingBlockMsg&&(this.decode(this.pendingBlockMsg),this.pendingBlockMsg=void 0)}))}decode(e){if(!this.decoder)return void(this.pendingBlockMsg=e);if(!this.primed){this.decoder.open(e.buffer);for(let e=0;e<5;++e)this.decoder.decode();this.decoder.close(),this.primed=!0}const t=performance.now();if(this.decodeDefinition){let t=this.decodeConfig?this.decodeConfig.lod:0;if(this.lodProfile&&this.lodProfile.representations.has(e.block.representationId)){const n=this.lodProfile.representations.get(e.block.representationId);n&&(t=n)}this.decodeDefinition.requiredLOD!=t&&(this.decodeDefinition.requiredLOD=t,this.decoder.setDecodeDefinition(this.decodeDefinition))}this.decoder.open(e.buffer),this.decoder.decode();let n=this.decoder.voxelFrame();const i=n.elementCount(),r=this.coordBufferStorage.get(i,Uint16Array),o=this.colourBufferStorage.get(i,Uint8Array);if(!n.coordinates(r)||!n.colours(o))return void(this._readPort&&this._readPort.postMessage(s.Msg.finishedWithBlockMsg(e.block.blockId)));const a=n.definition;n.release(),this.decoder.close();const c=performance.now();this.pendingFrame={geomType:0,geometry:{coordinates:r,colours:o,definition:a},primitiveCount:a.voxelCount,blockId:e.block.blockId,channelId:e.block.channelId,representationId:e.block.representationId,frameNumber:0,timestamp:e.block.timestamp,duration:e.block.duration,decodeTime:c-t,bitRate:e.block.bitRate},0==this.currentBlockId&&this.sendFrmae()}set readPort(e){this._readPort=e,this._readPort.onmessage=this.onMessage}sendFrmae(){this.pendingFrame?(c.postMessage(s.Msg.decodedFrameMsg(this.pendingFrame),[this.pendingFrame.geometry.coordinates.buffer,this.pendingFrame.geometry.colours.buffer]),this.currentBlockId=this.pendingFrame.blockId,this.pendingFrame=void 0,this._readPort&&this._readPort.postMessage(s.Msg.finishedWithBlockMsg(this.currentBlockId))):this.currentBlockId=0}updateDefinition(){this.decodeDefinition&&this.decoder&&(this.decodeConfig&&(this.decodeDefinition.requiredLOD=this.decodeConfig.lod),this.decoder.setDecodeDefinition(this.decodeDefinition))}};c.onmessage=d.onMessage})()})();